<html>
	<head>
		<script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
		<script type="text/javascript" src="igx_api.js"></script>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	</head>
	<script type="text/javascript">
		function Login() {
			var username = jQuery('#login_username').val();
			var password = jQuery('#login_password').val();
			if (username && password) {
				IGX.RESTful.MembershipProviders.Login(username, password, OnLogin);
			} else {
				alert('You need to enter both a username and password!');
			}
		}

		function Logout() {
			IGX.RESTful.MembershipProviders.Logout(OnLogout);
		}

		function OnLogin(result) {
			var treeNode = {
				"widgetId": "x77",
				"objectId": "x77",
				"index": 1
			}

			switch (result.code) {
				case 0:
					//IGX.Pages.syncSite('x109223','', 'dev-wes', show_result);
					IGX.RESTful.SchemaDesignerServices.GetSchemas(popSchemaList)
					$('#login-panel').fadeOut(function(){
						$('#application').fadeIn();
					});
					break;
				default:
					alert(result.error);
					break;
			}
		}

		function syncSite() {
			var schema = $('#schema-select option:selected').attr('data-val');
			var rootId = $('#root').val();
			var pubTarget = $('#pub-target').val();

			IGX.Pages.syncSite(rootId, schema, pubTarget, show_result);
		}

		function popSchemaList(response) {
			$(document).ready(function(){
				var schemas = response.message.pageSchemas;
				for (var i = 0; i < schemas.length; i++) {
					var scma = schemas[i]
					$('#schema-list tbody').html($('#schema-list tbody').html() + "<tr><td>" + JSON.parse(scma.Name).Name + "</td><td>" + scma.ID + "</td></tr>");
					$('#schema-select').html($('#schema-select').html() + "<option data-val=" +scma.ID+ ">" + JSON.parse(scma.Name).Name + "</option>");
				}
			});
		}

		function OnLogout(result) {
			jQuery('#login_panel').show();
			jQuery('#controls, #user_creation_panel').hide();
		}
	</script>

	<style type="text/css">
		.center-content {
			text-align: center;
		}

		#login-modal button{
			width: 100%;
			margin-top: 15px;
		}

		#application {
			display: none;
		}

	</style>

	<body>
		<main class="container">
			<div class="row" id="login-panel">
				<div class="col-xs-5"></div>
				<div class="col-xs-2 center-content" id="login_panel">
					<div id="login-modal">
						<div class="form-group">
							<label for="login_username">Username</label>
							<input class="form-control" id="login_username" type="text">
						</div>
						<div class="form-group">
							<label for="login_password">Password</label>
							<input class="form-control" id="login_password" type="password">
						</div>
						<div>
							<button class="btn btn-default" onclick="Login();">Login</button>
						</div>
					</div>
				</div>
				<div class="col-xs-5"></div>
			</div>
			<div id="application" class="row">
				<div class="col-md-6">
					<div id="controls">
						<h2>Site Sync</h2>
						<div id="site-sync">
							<label for="schema-select">Schema to Sync in site:</label>
					      <select class="form-control" id="schema-select">
					      </select>
							<br>
							<div class="form-group">
							  <label for="pub-target">Publishing Target (i.e. dev-wes)</label>
							  <input type="text" class="form-control" id="pub-target">
							</div>
							<div class="form-group">
							  <label for="root">Site Root xID</label>
							  <input type="text" class="form-control" id="root">
							</div>
							<br>
							<button class="btn btn-primary pull-right" onclick="syncSite()">
								Sync Site
							</button>
						</div>
					</div>
				</div>
				<div class="col-md-6">
					<div id="schema-list">
						<h2>Schemas</h2>
							<table id="schema-list" class="table table-striped">
								<thead>
									<tr>
										<th>Schema Name</th>
										<th>Schema ID</th>
									</tr>
								</thead>
								<tbody>

								</tbody>
							</table>
					</div>
				</div>
			</div>
		</main>
	</body>
</html>
